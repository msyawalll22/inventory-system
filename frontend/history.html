<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transaction History | Elite System</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 font-sans p-8">
    <div id="app" class="max-w-5xl mx-auto">
        <header class="mb-10 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black uppercase tracking-tighter italic">Stock <span class="text-blue-500">Log</span></h1>
                <p class="text-gray-500 text-[10px] font-bold uppercase tracking-widest">Inventory Transaction Audit</p>
            </div>
            <a href="index.html" class="bg-gray-800 px-6 py-2 rounded-xl text-[10px] font-black uppercase hover:bg-gray-700 border border-gray-700 transition-all shadow-lg">Back to POS</a>
        </header>

        <div class="bg-gray-800 rounded-3xl border border-gray-700 overflow-hidden shadow-2xl">
            <table class="w-full text-left border-collapse">
                <thead class="bg-gray-900/50 text-gray-500 uppercase text-[10px] font-black tracking-widest">
                    <tr>
                        <th class="p-5 border-b border-gray-700">Timestamp</th>
                        <th class="p-5 border-b border-gray-700">Product Item</th>
                        <th class="p-5 border-b border-gray-700 text-center">Action</th>
                        <th class="p-5 border-b border-gray-700 text-right">Qty Change</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-700/50">
                    <tr v-if="transactions.length === 0">
                        <td colspan="4" class="p-20 text-center text-gray-600 italic tracking-widest uppercase text-xs">
                            No transactions recorded yet.
                        </td>
                    </tr>
                    
                    <tr v-for="t in transactions" :key="t.id" class="hover:bg-blue-500/5 transition-colors group">
                        <td class="p-5 font-mono text-[11px] text-gray-400 group-hover:text-gray-200">
                            {{ t.createdAt ? formatDate(t.createdAt) : '---' }}
                        </td>
                        
                        <td class="p-5">
                            <div class="font-bold text-white tracking-tight">
                                {{ t.product ? t.product.name : 'Unknown Product' }}
                            </div>
                            <div class="text-[9px] text-gray-500 font-mono italic">{{ t.reference || 'No Reference' }}</div>
                        </td>
                        
                        <td class="p-5 text-center">
                            <span :class="t.quantity < 0 ? 'bg-red-500/10 text-red-500 border-red-500/20' : 'bg-green-500/10 text-green-500 border-green-500/20'" 
                                  class="px-3 py-1 rounded-full text-[9px] font-black border uppercase tracking-tighter">
                                {{ t.description || (t.quantity < 0 ? 'SALE' : 'RESTOCK') }}
                            </span>
                        </td>
                        
                        <td class="p-5 text-right font-mono font-black text-lg" 
                            :class="t.quantity < 0 ? 'text-red-400' : 'text-green-400'">
                            {{ t.quantity > 0 ? '+' : '' }}{{ t.quantity }}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return { transactions: [] }
            },
            methods: {
                async fetchHistory() {
                    try {
                        const res = await fetch('http://localhost:8080/api/inventory-transactions');
                        if (!res.ok) throw new Error("Backend not responding");
                        this.transactions = await res.json();
                    } catch (err) {
                        console.error("Fetch error:", err);
                    }
                },
                formatDate(dateString) {
                    const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                    return new Date(dateString).toLocaleDateString('en-US', options);
                }
            },
            mounted() { this.fetchHistory(); }
        }).mount('#app')
    </script>
</body>
</html>