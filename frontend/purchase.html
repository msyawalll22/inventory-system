<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Procurement | Elite System</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 font-sans h-screen flex flex-col text-sm">

    <div id="app" class="flex flex-col h-full">
        <nav class="bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center shadow-2xl">
            <div class="flex items-center gap-8">
                <h1 class="text-xl font-black tracking-tighter text-white italic uppercase">Elite <span class="text-blue-500">Procure</span></h1>
                <div class="flex gap-6 border-l border-gray-700 ml-2 pl-6">
                    <a href="index.html" class="text-gray-400 hover:text-blue-400 font-bold uppercase text-[10px] tracking-widest transition-colors">POS</a>
                    <a href="purchase.html" class="text-blue-500 font-bold uppercase text-[10px] tracking-widest">New Purchase</a>
                    <a href="inventory.html" class="text-gray-400 hover:text-blue-400 font-bold uppercase text-[10px] tracking-widest transition-colors">Inventory Audit</a>
                </div>
            </div>
        </nav>

        <main class="flex-grow flex items-center justify-center p-8 overflow-y-auto">
            <div class="w-full max-w-2xl bg-gray-800 p-10 rounded-[2.5rem] border border-gray-700 shadow-2xl my-8">
                <div class="mb-8">
                    <h2 class="text-2xl font-black uppercase tracking-tighter text-white">Receive <span class="text-blue-500">Stock</span></h2>
                    <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest">Assign Supplier and Category to New Items</p>
                </div>

                <form @submit.prevent="submitPurchase" class="space-y-6">
                    
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase tracking-widest block mb-2">Supplier</label>
                            <select v-model="form.supplierId" required
                                    class="w-full bg-gray-900 border-2 border-gray-700 rounded-2xl p-4 focus:border-blue-500 outline-none transition-all text-white appearance-none cursor-pointer">
                                <option :value="null" disabled>Select Supplier...</option>
                                <option v-for="s in suppliers" :key="s.id" :value="s.id">{{ s.name }}</option>
                            </select>
                        </div>

                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase tracking-widest block mb-2">Category</label>
                            <select v-model="form.categoryId" required
                                    class="w-full bg-gray-900 border-2 border-gray-700 rounded-2xl p-4 focus:border-blue-500 outline-none transition-all text-white appearance-none cursor-pointer">
                                <option :value="null" disabled>Select Category...</option>
                                <option v-for="c in categories" :key="c.id" :value="c.id">{{ c.name }}</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] text-gray-400 font-black uppercase tracking-widest block mb-2">Laptop Model Name</label>
                        <input v-model="form.name" type="text" placeholder="e.g. Dell XPS 13" required
                               class="w-full bg-gray-900 border-2 border-gray-700 rounded-2xl p-4 focus:border-blue-500 outline-none transition-all">
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase tracking-widest block mb-2">Cost Price ($)</label>
                            <input v-model.number="form.price" type="number" placeholder="0.00" required
                                   class="w-full bg-gray-900 border-2 border-gray-700 rounded-2xl p-4 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 font-black uppercase tracking-widest block mb-2">Units Received</label>
                            <input v-model.number="form.quantity" type="number" placeholder="0" required
                                   class="w-full bg-gray-900 border-2 border-gray-700 rounded-2xl p-4 focus:border-blue-500 outline-none transition-all">
                        </div>
                    </div>

                    <button type="submit" 
                            class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-5 rounded-2xl uppercase tracking-[0.3em] transition-all shadow-xl shadow-blue-500/20 active:scale-95">
                        Add to Warehouse
                    </button>
                </form>
            </div>
        </main>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return { 
                    suppliers: [], 
                    categories: [],
                    form: { 
                        name: '', 
                        price: null, 
                        quantity: null,
                        supplierId: null,
                        categoryId: null
                    } 
                }
            },
            methods: {
                async fetchData() {
                    try {
                        const [supRes, catRes] = await Promise.all([
                            fetch('http://localhost:8080/api/suppliers'),
                            fetch('http://localhost:8080/api/categories')
                        ]);
                        this.suppliers = await supRes.json();
                        this.categories = await catRes.json();
                    } catch (error) {
                        console.error("Fetch error:", error);
                    }
                },
                async submitPurchase() {
                    try {
                        const res = await fetch('http://localhost:8080/api/products', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.form)
                        });
                        if (res.ok) {
                            alert("Product successfully registered under category!");
                            this.form = { name: '', price: null, quantity: null, supplierId: null, categoryId: null };
                        }
                    } catch (error) {
                        alert("Backend connection failed.");
                    }
                }
            },
            mounted() {
                this.fetchData();
            }
        }).mount('#app')
    </script>
</body>
</html>